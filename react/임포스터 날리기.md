## 임포스터날리기를 만들기

블로그가 밋밋하기도하고 최근 가장 좋아하는 어몽어스에 나오는 임포스터라는 포지션캐릭터가 퇴출되는 모습이 아른거려 블로그에 넣어야지로 시작했읍니다.

~~역시 쓸대없는 짓이 가장 재밌..~~

아주 단순히 그냥 날아가는 임포스터 이미지를 가진 컴포넌트를 생성하는 게 다인데 만드는 게 익숙하지 않고 이론만 봤던지라 많은 생각을 했습니다.

(애니메이션이 처음부터 시작하지 않게 하려면 앞서 누른 클릭 이벤트에서 다음 이벤트사이 시간을 보고 애니메이션이 시작되는 점을 새로 지정해 줘야 하는 건가...라는 생각까지 했는데 이건 좀..)

저런 생각들을 하다가 일단 만들 자로 시작했고

여하튼 클릭이벤트 -> 임포스터 컴포넌트 생성 -> 누를 때마다 각자 자기 갈길 가는 임포스터가 되도록

### 순서

- window에 왼쪽에서 오른쪽 끝으로 날아가는걸 목표로 Imposter 객체를 만들기(생성이후 N초뒤 사라지는 객체)
- Among이라는 객체에 Emergency버튼을 만들고 클릭이벤트 발생시 Imposter객체가 생성되도록 만들기
- css @keyframe에 위치값 랜덤 변수받아 연결하기
- 아무위치에서 생성되는 임포스터가 끊이지 않고 갈길 가게 만들기

#### Imposter 컴포넌트

날아가는 임포스터의 실체입니다.

```javascript
const Impo = ({ SV, EV }) => {
  const [unMount, useUnMount] = useState(true);

  useEffect(() => {
    setTimeout(() => {
      useUnMount(false);
    }, 5000);
  }, []);

  if (unMount) {
    return (
      <>
        <Imposter sv={SV} ev={EV} src={"/media/black_among.png"} />
      </>
    );
  } else {
    return <></>; // 찐으로 언마운트 되는 방향으로 수정하겠읍니다..
  }
};
```

css애니메이션 속도에 맞춰 5초뒤에 사라지는 방향으로 만들었습니다 SV EV는 임포스터가 날아가는 경로의 시작점과 끝점을 받아오는 값입니다.

#### Among 컴포넌트

Among이라는 컴포넌트이고 버튼과 이벤트 그리고 Impo컴포넌트를 생성하는 코드가 들어있습니다.

map객체로 애니메이션이 끊이지 않게 보여주는게 되는건가 싶었는데 가능 했습니다.

```javascript
const Among = () => {
  const [impos, useImpos] = useState([]);

  const work = () => {
    const SV = Math.floor(Math.random() * 100);
    const EV = Math.floor(Math.random() * 100);
    useImpos(impos.concat(React.cloneElement(<Impo SV={SV} EV={EV} />)));
  };

  return (
    <>
      <div className={styles.makeImpo} onClick={work}>
        <span>EMERGENCY</span>
      </div>
      <div className={styles.backgroundAmongWrap}>
        {impos.map((i, key) => {
          return i;
        })}
      </div>
    </>
  );
};
```

#### 얻은 것들

**생각**

컴포넌트가 생성되자마자 css 애니메이션이 시작되고 몇초뒤엔 사라진다. 누르는 시점부터 끊이지 않고 날아가야하는게 가장 중요한데 list인 상태를 만들고 map객체로 뿌릴시 '분명 누를때만다 끊기겠지'라는 생각을 했습니다. map객체는 for문처럼 리스트를 순서대로 돌며 함수를 적용해 새로운 리스트를 반환하는데 이때문에 클릭할때마다 새로 돌아처음 만들어진 객체도 다시 생성될 줄 알았고 그래서 '끊긴다'라 생각을했는데 왠일인지 끊기지 않는다..?

이는 왼쪽에서 오른쪽 랜덤위치를 지정하지 않고 그냥 같은경로로 여러 임포스터가 날아가는 상태였고 '이렇게 쉽게 만들어진다고'라고 생각했으나 키프레임에 변수를 적용하기위헤 Imposter컴포넌트에 값을 추가하자마자 리액트는 원래 생각했던 대로 전부 끊겨나가기 시작했습니다.

5초뒤에 컴포넌트를 죽였는데 흐르는 5초 중 이벤트가 발생하면 가상돔은 Impo객체의 시작,끝 위치값에 변화를 보고 '이거 달라요 빼액'하며 다시 렌더링 했고 css 애니메이션은 처음부터 돌다가 중간에 죽었다(이벤트 발생기준으로 시간은 또 잘지켜지네)..

그래서 이래저래 고치고 만지면서 결국 도달한 결과는

- 리액트 가상돔과 실제돔의 비교기준
  - 원래생각 : 상태값이 바뀌면 해당 컴포넌트가 리렌더링 되는것만 알고 있었음
  - 추가 : props로 받은 값의 영향
    처음에 Impo 컴포넌트에 랜덤위치생성 함수와 값을 넣었는데 이때문에 컴포넌트는 단체로 리렌더링되었다. 이를 부모컴포넌트에서 처리후 고정적인 값으로 따로 넘겨주었을때는 정상작동하였다.
  - 추가 : 같은 레이어에서 컴포넌트들이 배치된 위치의 변화를 찾는지는 찾아보려는데 갑자기 gatsby의 작동이 이상해졌다... 추후 추가하겠음다.
- **어몽어스 캐릭터**가 날아다니는게 너무 **귀엽다**

### createElement와 cloneElement의 차이

컴포넌트내부의 변화와 Propa의 변화가 가상돔의 비교에 영향

컴포넌트 내부에서 값이 바뀔때랑 Props의 값이 바뀔때의 차이로 끊기고 안끊기고의 차이가이었다.

리렌더링을 시키지 않기위해 랜덤값을 뽑는 과정을 부모 컴포넌트에서 처리하고 아래에서 받으니 추가된 컴포넌트만 독단적으로 생산되고 나머지는 생성 시점부터 쭉 이어져나갔다.

### styled components

keyframe에 변수를 받기위해 사용했는데 키프레임에 변수를 받으려면

변수의 이동경로

컴포넌트 -> 클래스컴포넌트의 animation속성의 키프레임 파라밈터 -> 키프레임

과 같이 도달해야한다.
