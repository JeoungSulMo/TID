# 인증 방식

장고로 유저인증관련 구현을 하기위해 인증 방식들을 찾아보다 정리 합니다.

- 인증이 필요한 이유
- 웹/앱 서비스에 사용될만한 인증 방식
  - 쿠키/세션 인증방식
  - JWT를 이용한 방식

## 인증이 필요한 이유

서비스를 제공하는 서버 측에서 공통된 데이터를 주는 게 아닌 서비스 사용자 별로 맞춘 정보 제공하기 위해서 인증절차가 필요하다. 서버 측에서는 다양한 요청이 들어올 때 요청자의 정보를 가진 고유한 정보로 해당 유저를 구분하여 정보나 서비스를 제공한다.

예를 들면 네이버에서 로그인을 하지 않아도 기사, 실검, 지식인 등을 사용 가능하다. 하지만 지식인 질문, 개인 이메일 등 유저에 대한 정보가 필요하고 개인에 맞춘 정보가 필요한 서비스는 로그인 이후 제공하게 되는데 로그인을 시작으로 로그아웃까지의 기능 구현에 있어 인증을 절차가 필요하고 개인정보가 포함되어있기 때문에 보안까지 생각해봐야 하는 기능 구현이 된다.

## 웹/앱 서비스에서 사용되는 인증 방식

지속적으로 개인정보를 주고 받으며 인증을 하게되면 보안상 좋지 않다고 하여 아래와 같은 방법들을 사용한다고 합니다.

토큰/세션 인증방식과 JWT 두가지를 알아보았고 간단히 기록합니다.

참고한 블로그 : https://tansfil.tistory.com/58

이 블로그 글이 가장 이해하기 좋았습니다. 개인적으로..

### 쿠키/세션 인증방식

- 로그인
  1. 사용자가 로그인 서버에 요청합니다.
  2. 사용자가 보낸 ID와 PW를 받은 서버는 회원db를 통해 사용자를 확인합니다.
  3. 확인이 완료되면 서버의 세션 저장소에 회원정보 세션을 만들고 세션의 id를 다시 사용자에게 보냅니다.
  4. 사용자는 세션 id를 쿠키의 형태로 로컬(브라우저)에 보유하고 있습니다.
  5. 여기까지가 로그인의 완료입니다.
- 로그인 이후 요청에대한 인증과정(개인의 식별이 필요한 요청시)
  1. 로그인이 완료된 사용자의 브라우저는 로그인때 받은 세션id을 쿠키로 로컬에 보유하고 있게됩니다.
  2. 개인적인 정보가 필요한 요청을 보낼때 마다 요청에 쿠키를 같이 담아 보내게 됩니다.
  3. 요청을 받은 서버는 해당요청의 쿠키를 가지고 세션 저장소를 통해 검증을 합니다.
  4. 검증이 완료되면 요청에대한 응답을 사용자에게 제공합니다.

### JWT를 사용한 인증방식

json형식의 데이터를 암호화하여 웹 토큰으로 사용하는 방식의 토큰입니다.

생긴 모습은 암호화된 문자열의 모습이며 `.`으로 구분되어 3가지 파트가 있습니다. 이 세가지 파트는 Header, payload, verify signature가 있으며 최종적으로

    Encoded Header + "." + Encoded Payload + "." + Verify Signature

이런 모습입니다.

정보가 담긴 암호화 문자열을 가지고 인증절차를 가집니다.

쿠키/세션과의 차이점은 서버측에서 세션 저장소를 따로 운영할 필요없이 검증만 해주면 됩니다.

- 로그인
  1. 사용자가 로그인 서버에 요청합니다.
  2. 사용자가 보낸 ID와 PW를 받은 서버는 회원db를 통해 사용자를 확인합니다.
  3. 확인이 완료되면 원하는 설정과 정보를 포함한 JWT를 생성하고 사용자에게 응답합니다.
  4. 사용자는 jwt를 로컬(브라우저)에 저장합니다.
- 로그인 이후 요청에대한 인증과정(개인의 식별이 필요한 요청시)
  1. 로그인시 받은 jwt를 요청에 함께 보냅니다.
  2. 서버는 토큰을 검증하고 그에 따른 데이터와 응답을 보냅니다.
